/*global tinymce:true */

tinymce.PluginManager.add("smiles", function(tinyObject, pluginUrl)
{

	tinyObject.addButton('smiles', {
		type: "panelbutton",
		icon: 'emoticons',
		panel: {
			role: "application",
			autohide: !0,
			html: function()
			{
				var html;

				html = '<div style="max-width: 500px;white-space: initial;" role="list" class="mce-grid">';

				tinymce.each(tinyObject.settings.smilesArray, function(item)
				{
					html += '<a href="#" style="display:inline-block;margin: 2px;" data-mce-url="' + item.url +
					'" data-mce-alt="' + item.title +
					'" tabindex="-1"role="option" aria-label="' + item.title + '">';

					html += '<img src="' + item.url + '" role="presentation" alt="' + item.title + '">';

					html += '</a> ';
				});

				html += "</div>";

				return html;
			},

			onclick: function(e)
			{
				var a = tinyObject.dom.getParent(e.target, "a");
				a && (
					tinyObject.insertContent(
						'<img class="smile" src="' + a.getAttribute("data-mce-url") + '" alt="' + a.getAttribute("data-mce-alt") + '" />'),
						this.hide()
				);
			}
		},
		tooltip: "Smiles"
	});
});